version: '3.8'

services:
  mkfd:
    image: tbosk/mkfd:latest
    container_name: mkfd
    ports:
      - "${PORT:-5000}:5000"
    volumes:
      - ./configs:/app/configs
      # Mount Chrome extensions directory (optional)
      # Place unpacked extensions in ./extensions/
      - ./extensions:/app/extensions
    environment:
      - PASSKEY=${PASSKEY:-your_passkey_here}
      - COOKIE_SECRET=${COOKIE_SECRET:-your_cookie_secret_here}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY:-your_encryption_key_here}
      - SSL=${SSL:-false}
      # Path to Chrome extensions directory for advanced scraping
      - CHROME_EXTENSIONS_PATH=${CHROME_EXTENSIONS_PATH:-/app/extensions}
      # Uncomment to override default 4GB memory allocation for IMAP processes
      # - NODE_OPTIONS=--max-old-space-size=8192
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/"]
      interval: 5m
      timeout: 10s
      retries: 3
      start_period: 1m

  # Optional: Autoheal service to automatically restart unhealthy containers
  # Uncomment the section below to enable automatic container restarts on healthcheck failure
  # autoheal:
  #   image: willfarrell/autoheal:latest
  #   container_name: autoheal
  #   restart: unless-stopped
  #   environment:
  #     - AUTOHEAL_CONTAINER_LABEL=all
  #   volumes:
  #     - /var/run/docker.sock:/var/run/docker.sock
